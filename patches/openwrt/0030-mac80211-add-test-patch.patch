From: Matthias Schiffer <mschiffer@universe-factory.net>
Date: Tue, 7 Jun 2016 14:13:55 +0200
Subject: mac80211: add test patch

diff --git a/package/kernel/mac80211/patches/990-test.patch b/package/kernel/mac80211/patches/990-test.patch
new file mode 100644
index 0000000..846389e
--- /dev/null
+++ b/package/kernel/mac80211/patches/990-test.patch
@@ -0,0 +1,38 @@
+--- a/drivers/net/wireless/ath/ath9k/mac.c
++++ b/drivers/net/wireless/ath/ath9k/mac.c
+@@ -678,7 +678,7 @@ void ath9k_hw_startpcureceive(struct ath
+ 	ath9k_ani_reset(ah, is_scanning);
+ 
+ 	REG_CLR_BIT(ah, AR_DIAG_SW,
+-		    AR_DIAG_RX_DIS | AR_DIAG_RX_ABORT | AR_DIAG_FORCE_RX_CLEAR);
++		    AR_DIAG_RX_DIS | AR_DIAG_RX_ABORT);
+ }
+ EXPORT_SYMBOL(ath9k_hw_startpcureceive);
+ 
+@@ -686,8 +686,6 @@ void ath9k_hw_abortpcurecv(struct ath_hw
+ {
+ 	u32 reg = AR_DIAG_RX_DIS | AR_DIAG_RX_ABORT;
+ 
+-	if (!config_enabled(CPTCFG_ATH9K_TX99))
+-		reg |= AR_DIAG_FORCE_RX_CLEAR;
+ 	REG_SET_BIT(ah, AR_DIAG_SW, reg);
+ 
+ 	ath9k_hw_disable_mib_counters(ah);
+--- a/drivers/net/wireless/ath/ath9k/main.c
++++ b/drivers/net/wireless/ath/ath9k/main.c
+@@ -216,13 +216,8 @@ static bool ath_prepare_reset(struct ath
+ 	ath_stop_ani(sc);
+ 	ath9k_hw_disable_interrupts(ah);
+ 
+-	if (AR_SREV_9300_20_OR_LATER(ah)) {
+-		ret &= ath_stoprecv(sc);
+-		ret &= ath_drain_all_txq(sc);
+-	} else {
+-		ret &= ath_drain_all_txq(sc);
+-		ret &= ath_stoprecv(sc);
+-	}
++	ret &= ath_drain_all_txq(sc);
++	ret &= ath_stoprecv(sc);
+ 
+ 	return ret;
+ }
